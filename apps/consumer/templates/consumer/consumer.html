{% extends 'base.html' %}
{% load static %}

{% block content %}

<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LinkShort - Premium URL Shortener</title>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/consumer.css' %}">
</head>

<div class="container">
    <h1 class="w3-serif">LinkShort URL Shortener</h1>
    <p class="description">Create short, memorable links and track your audience</p>

    <form action="{% url 'post_long_url' %}" method="POST" class="form-container">
        {% csrf_token %}
        <input type="url" name="long_url"  class="w3-monospace" placeholder="Paste your long URL here..." required>
        <button type="submit" class="w3-monospace">
            <i class="fas fa-link"></i> Shorten
        </button>
    </form>

    <table>
        <thead class="w3-monospace">
            <tr>
                <th>Original URL</th>
                <th>Short URL</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for url in short_urls %}
                <tr>
                    <td class="original-url-cell">{{ url.long_url|truncatechars:40 }}</td>
                    <td class="short-url-cell">
                        <a href="{% url 'preprocess_redirect' url.short_url %}" target="_blank">
                            {{ request.get_host }}/r/{{ url.short_url }}
                        </a>
                    </td>
                   <td>
                        <a href="{% url 'preprocess_redirect' url.short_url %}" class="action-link" target="_blank">
                            <i class="fas fa-external-link-alt"></i>
                        </a>

                        <a href="#" class="action-link w3-blue" onclick="copyShortUrl('{{ request.get_host }}/r/{{ url.short_url }}'); return false;">
                            <i class="fas fa-copy"></i>
                        </a>

                        <form action="{% url 'delete-short-url' url.id %}" method="POST" style="display:inline;" 
                            onsubmit="return confirm('Are you sure you want to delete this URL?');">
                            {% csrf_token %}
                            <button type="submit" class="action-link w3-red w3-padding" style="border:none; background:none; padding:0; cursor:pointer;">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </form>
                    </td>
                </tr>
            {% empty %}

                <tr>
                    <td colspan="3" class="empty-message">No shortened URLs yet. Create your first one above!</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
function copyShortUrl(shortUrl) {
    navigator.clipboard.writeText(shortUrl).then(() => {
        alert('Copied to clipboard: ' + shortUrl);
    }).catch(err => {
        alert('Failed to copy URL: ' + err);
    });
}
</script>

{% endblock %}


